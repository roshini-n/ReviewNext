import{a as we}from"./chunk-S4KP2ZEG.js";import{g as Se,h as Be,i as Me,j as ye,k as Fe,l as Ie,m as xe,n as Ee,o as Ae,p as Oe}from"./chunk-ON2IKYVN.js";import{$ as ee,Bb as ge,Cb as fe,Db as he,Eb as be,Hb as ke,Ib as ve,Kb as _e,Lb as Ce,Nb as Pe,R as Q,Ra as le,T as k,V as X,W as Z,ab as me,b as K,ba as te,da as oe,fa as re,ga as ie,gb as se,h as W,ha as ne,hb as ce,i as Y,ia as ae,ib as pe,jb as de,k as J,kb as ue}from"./chunk-VRLREQ5H.js";import{$b as x,$c as j,Ab as g,H as M,Ib as s,J as G,L as w,P as y,Sb as a,Tb as i,Ub as f,Yb as V,Z as P,ad as H,dd as $,ea as N,h as D,hb as m,id as z,ja as R,ka as S,kc as E,lc as l,nc as A,ta as F,u as U,ua as I,ub as L,xc as q,y as B,yc as T}from"./chunk-5JKIZQAZ.js";var O=class n{constructor(e){this.http=e}baseUrl="https://openlibrary.org/search.json";searchBook(e,r,t){if(console.log("BookCoverService: Starting search for book:",{title:e,author:r,year:t}),!e||e.length<2)return console.log("BookCoverService: Title too short, skipping search"),new D(d=>{d.next(""),d.complete()});let o=this.cleanTitle(e);console.log("BookCoverService: Cleaned title:",o);let c=`title:${encodeURIComponent(e)}`;r&&(c+=`+author:${encodeURIComponent(r)}`),t&&(c+=`+first_publish_year:${t}`);let h=`${this.baseUrl}?q=${c}&limit=10`;return console.log("BookCoverService: Making request to Open Library API:",h),this.http.get(h).pipe(B(d=>{if(console.log("BookCoverService: Open Library response:",d),!d.docs||d.docs.length===0)return console.log("BookCoverService: No results found"),"";let v=d.docs.find(p=>{let u=this.cleanTitle(p.title),b=u===o||u.includes(o)||o.includes(u);return console.log("BookCoverService: Checking exact match:",{bookTitle:u,cleanTitle:o,isExactMatch:b}),b});if(v?.cover_i){console.log("BookCoverService: Found exact match:",v.title);let p=this.getCoverUrl(v.cover_i);return console.log("BookCoverService: Image URL:",p),p}let _=d.docs.find(p=>{let u=this.cleanTitle(p.title),b=this.calculateSimilarity(u,o);return console.log("BookCoverService: Checking similarity:",{bookTitle:u,cleanTitle:o,similarity:b}),u.includes(o)||o.includes(u)||b>.7});if(_?.cover_i){console.log("BookCoverService: Found closest match:",_.title);let p=this.getCoverUrl(_.cover_i);return console.log("BookCoverService: Image URL:",p),p}let C=d.docs.find(p=>p.cover_i);if(C?.cover_i){console.log("BookCoverService: Using first result with cover:",C.title);let p=this.getCoverUrl(C.cover_i);return console.log("BookCoverService: Image URL:",p),p}return console.log("BookCoverService: No suitable image found"),""}),G(d=>(console.error("BookCoverService: Error searching book:",d),U(()=>new Error("Failed to search for book image")))))}cleanTitle(e){return e.toLowerCase().replace(/[^a-z0-9]/g,"").replace(/the/g,"").replace(/book/g,"").replace(/edition/g,"").replace(/deluxe/g,"").replace(/special/g,"").replace(/collectors/g,"").replace(/hardcover/g,"").replace(/paperback/g,"").replace(/kindle/g,"").replace(/ebook/g,"").trim()}calculateSimilarity(e,r){let t=e.length>r.length?e:r,o=e.length>r.length?r:e;return t.length===0?1:(t.length-this.editDistance(t,o))/t.length}editDistance(e,r){let t=Array(r.length+1).fill(null).map(()=>Array(e.length+1).fill(null));for(let o=0;o<=e.length;o+=1)t[0][o]=o;for(let o=0;o<=r.length;o+=1)t[o][0]=o;for(let o=1;o<=r.length;o+=1)for(let c=1;c<=e.length;c+=1){let h=e[c-1]===r[o-1]?0:1;t[o][c]=Math.min(t[o][c-1]+1,t[o-1][c]+1,t[o-1][c-1]+h)}return t[r.length][e.length]}getCoverUrl(e){return`https://covers.openlibrary.org/b/id/${e}-L.jpg`}static \u0275fac=function(r){return new(r||n)(R(K))};static \u0275prov=N({token:n,factory:n.\u0275fac,providedIn:"root"})};function De(n,e){n&1&&(a(0,"mat-error"),l(1,"Title is required"),i())}function Ue(n,e){n&1&&(a(0,"mat-error"),l(1,"Author is required"),i())}function Ge(n,e){n&1&&(a(0,"mat-error"),l(1,"Publisher is required"),i())}function Ne(n,e){n&1&&(a(0,"mat-error"),l(1,"Publication date is required"),i())}function Re(n,e){n&1&&(a(0,"mat-error"),l(1,"Description is required"),i())}function Le(n,e){if(n&1&&(a(0,"mat-option",24),l(1),i()),n&2){let r=e.$implicit;s("value",r),m(),A(" ",r," ")}}function Ve(n,e){if(n&1&&(a(0,"mat-option",24),l(1),i()),n&2){let r=e.$implicit;s("value",r),m(),A(" ",r," ")}}function je(n,e){n&1&&(a(0,"mat-hint")(1,"mat-icon",25),l(2,"search"),i(),l(3," Searching for book cover... "),i())}function He(n,e){n&1&&(a(0,"mat-hint"),l(1," Book cover found! You can change this URL if needed. "),i())}function $e(n,e){n&1&&(a(0,"mat-error"),l(1,"Image URL is required"),i())}function ze(n,e){n&1&&(a(0,"mat-icon",25),l(1,"hourglass_empty"),i())}var qe=class n{fb=S(ie);bookService=S(we);bookCoverService=S(O);snackBar=S(Ie);router=S(W);bookForm=this.fb.group({title:["",[k.required]],description:["",[k.required]],imageUrl:["",[k.required]],author:["",[k.required]],publisher:["",[k.required]],platformInput:[""],genreInput:[""],publicationDate:["",[k.required]]});separatorKeysCodes=[13,188];platforms=[];selectedGenres=[];isSubmitting=!1;isSearchingImage=!1;options=["Hardcover","Paperback","E-book","Audiobook","Kindle","Nook","Google Books","Apple Books","Kobo","Other"];genres=["Fiction","Non-Fiction","Mystery","Romance","Science Fiction","Fantasy","Horror","Thriller","Biography","History","Self-Help","Business","Science","Technology","Philosophy","Poetry","Drama","Comedy","Adventure","Children's"];filteredOptions;filteredGenres;ngOnInit(){this.filteredOptions=this.bookForm.get("platformInput").valueChanges.pipe(P(""),B(e=>this._filter(e,this.options))),this.filteredGenres=this.bookForm.get("genreInput").valueChanges.pipe(P(""),B(e=>this._filter(e,this.genres))),this.bookForm.get("title")?.valueChanges.pipe(w(500),y(),M(e=>e&&e.length>2)).subscribe(e=>{console.log("AddBookComponent: Title changed:",e),this.searchForBookImage(e)}),this.bookForm.get("author")?.valueChanges.pipe(w(500),y(),M(e=>e&&e.length>2)).subscribe(e=>{console.log("AddBookComponent: Author changed:",e);let r=this.bookForm.get("title")?.value;r&&this.searchForBookImage(r,e)}),this.bookForm.get("publicationDate")?.valueChanges.pipe(y(),M(e=>e&&this.bookForm.get("title")?.value)).subscribe(e=>{console.log("AddBookComponent: Publication date changed:",e);let r=this.bookForm.get("title")?.value,t=this.bookForm.get("author")?.value;r&&this.searchForBookImage(r,t,e?new Date(e).getFullYear():void 0)})}searchForBookImage(e,r,t){console.log("AddBookComponent: Searching for book image with params:",{title:e,author:r,year:t}),this.isSearchingImage=!0,this.bookCoverService.searchBook(e,r,t).subscribe({next:o=>{console.log("AddBookComponent: Received image URL:",o),o?(this.bookForm.patchValue({imageUrl:o},{emitEvent:!1}),console.log("AddBookComponent: Updated form with image URL:",o)):console.log("AddBookComponent: No image URL received"),this.isSearchingImage=!1},error:o=>{console.error("AddBookComponent: Error fetching book image:",o),this.isSearchingImage=!1}})}_filter(e,r){let t=e.toLowerCase();return r.filter(o=>o.toLowerCase().includes(t))}addPlatform(){let e=this.bookForm.get("platformInput")?.value;e&&!this.platforms.includes(e)&&this.platforms.push(e),this.bookForm.get("platformInput")?.setValue("")}removePlatform(e){this.platforms=this.platforms.filter(r=>r!==e)}addGenre(){let e=this.bookForm.get("genreInput")?.value;e&&!this.selectedGenres.includes(e)&&this.selectedGenres.push(e),this.bookForm.get("genreInput")?.setValue("")}removeGenre(e){this.selectedGenres=this.selectedGenres.filter(r=>r!==e)}onSubmit(){if(console.log("Form valid:",this.bookForm.valid),console.log("Platforms:",this.platforms),console.log("Genres:",this.selectedGenres),console.log("Form values:",this.bookForm.value),console.log("Form errors:",this.bookForm.errors),!this.bookForm.valid){let t="Please fill in all required fields:";this.bookForm.get("title")?.valid||(t+=`
- Title is required`),this.bookForm.get("description")?.valid||(t+=`
- Description is required`),this.bookForm.get("author")?.valid||(t+=`
- Author is required`),this.bookForm.get("publisher")?.valid||(t+=`
- Publisher is required`),this.bookForm.get("publicationDate")?.valid||(t+=`
- Publication date is required`),this.bookForm.get("imageUrl")?.valid||(t+=`
- Image URL is required`),this.snackBar.open(t,"Close",{duration:5e3});return}if(this.platforms.length===0){this.snackBar.open("Please add at least one platform","Close",{duration:3e3});return}if(this.selectedGenres.length===0){this.snackBar.open("Please add at least one genre","Close",{duration:3e3});return}this.isSubmitting=!0;let e=this.bookForm.value,r={title:e.title,description:e.description,author:e.author,publisher:e.publisher,publicationDate:e.publicationDate.toISOString(),imageUrl:e.imageUrl,platforms:this.platforms,genres:this.selectedGenres,rating:0,totalRatingScore:0,numRatings:0,views:0,dateAdded:new Date().toISOString()};this.bookService.addBook(r).subscribe({next:()=>{this.snackBar.open("Book added successfully!","Close",{duration:3e3}),this.router.navigate(["/books"])},error:t=>{console.error("Error adding book:",t),this.snackBar.open("Error adding book. Please try again.","Close",{duration:3e3}),this.isSubmitting=!1}})}onCancel(){this.router.navigate(["/books"])}static \u0275fac=function(r){return new(r||n)};static \u0275cmp=L({type:n,selectors:[["app-add-book"]],decls:70,vars:22,consts:[["picker",""],["auto","matAutocomplete"],["autoGenres","matAutocomplete"],[1,"add-book-container"],[1,"book-form",3,"ngSubmit","formGroup"],[1,"form-row"],["appearance","outline"],["matInput","","formControlName","title","required",""],[4,"ngIf"],["matInput","","formControlName","author","required",""],["matInput","","formControlName","publisher","required",""],["matInput","","formControlName","publicationDate","required","",3,"matDatepicker"],["matSuffix","",3,"for"],["appearance","outline",1,"full-width"],["matInput","","formControlName","description","required","","rows","4"],["matInput","","formControlName","platformInput",3,"matAutocomplete"],[3,"value",4,"ngFor","ngForOf"],["matSuffix","","mat-icon-button","","type","button",3,"click"],["matInput","","formControlName","genreInput",3,"matAutocomplete"],["matInput","","formControlName","imageUrl","required",""],[1,"button-row"],["mat-button","","type","button","routerLink","/books"],["mat-raised-button","","color","primary","type","submit",3,"disabled"],["class","spinner",4,"ngIf"],[3,"value"],[1,"spinner"]],template:function(r,t){if(r&1){let o=V();a(0,"div",3)(1,"h2"),l(2,"Add Book"),i(),a(3,"form",4),x("ngSubmit",function(){return F(o),I(t.onSubmit())}),a(4,"div",5)(5,"mat-form-field",6)(6,"mat-label"),l(7,"Title"),i(),f(8,"input",7),g(9,De,2,0,"mat-error",8),i(),a(10,"mat-form-field",6)(11,"mat-label"),l(12,"Author"),i(),f(13,"input",9),g(14,Ue,2,0,"mat-error",8),i()(),a(15,"div",5)(16,"mat-form-field",6)(17,"mat-label"),l(18,"Publisher"),i(),f(19,"input",10),g(20,Ge,2,0,"mat-error",8),i(),a(21,"mat-form-field",6)(22,"mat-label"),l(23,"Publication Date"),i(),f(24,"input",11)(25,"mat-datepicker-toggle",12)(26,"mat-datepicker",null,0),g(28,Ne,2,0,"mat-error",8),i()(),a(29,"mat-form-field",13)(30,"mat-label"),l(31,"Description"),i(),f(32,"textarea",14),g(33,Re,2,0,"mat-error",8),i(),a(34,"div",5)(35,"mat-form-field",6)(36,"mat-label"),l(37,"Platforms"),i(),f(38,"input",15),a(39,"mat-autocomplete",null,1),g(41,Le,2,2,"mat-option",16),q(42,"async"),i(),a(43,"button",17),x("click",function(){return F(o),I(t.addPlatform())}),a(44,"mat-icon"),l(45,"add"),i()()(),a(46,"mat-form-field",6)(47,"mat-label"),l(48,"Genres"),i(),f(49,"input",18),a(50,"mat-autocomplete",null,2),g(52,Ve,2,2,"mat-option",16),q(53,"async"),i(),a(54,"button",17),x("click",function(){return F(o),I(t.addGenre())}),a(55,"mat-icon"),l(56,"add"),i()()()(),a(57,"mat-form-field",13)(58,"mat-label"),l(59,"Image URL"),i(),f(60,"input",19),g(61,je,4,0,"mat-hint",8)(62,He,2,0,"mat-hint",8)(63,$e,2,0,"mat-error",8),i(),a(64,"div",20)(65,"button",21),l(66,"Cancel"),i(),a(67,"button",22),g(68,ze,2,0,"mat-icon",23),l(69),i()()()()}if(r&2){let o,c,h,d,v,_,C,p=E(27),u=E(40),b=E(51);m(3),s("formGroup",t.bookForm),m(6),s("ngIf",(o=t.bookForm.get("title"))==null?null:o.hasError("required")),m(5),s("ngIf",(c=t.bookForm.get("author"))==null?null:c.hasError("required")),m(6),s("ngIf",(h=t.bookForm.get("publisher"))==null?null:h.hasError("required")),m(4),s("matDatepicker",p),m(),s("for",p),m(3),s("ngIf",(d=t.bookForm.get("publicationDate"))==null?null:d.hasError("required")),m(5),s("ngIf",(v=t.bookForm.get("description"))==null?null:v.hasError("required")),m(5),s("matAutocomplete",u),m(3),s("ngForOf",T(42,18,t.filteredOptions)),m(8),s("matAutocomplete",b),m(3),s("ngForOf",T(53,20,t.filteredGenres)),m(9),s("ngIf",t.isSearchingImage),m(),s("ngIf",!t.isSearchingImage&&((_=t.bookForm.get("imageUrl"))==null?null:_.value)),m(),s("ngIf",(C=t.bookForm.get("imageUrl"))==null?null:C.hasError("required")),m(4),s("disabled",t.isSubmitting),m(),s("ngIf",t.isSubmitting),m(),A(" ",t.isSubmitting?"Adding Book...":"Add Book"," ")}},dependencies:[z,j,H,$,J,Y,ae,ee,Q,X,Z,re,te,oe,ne,ve,ke,ge,he,fe,be,Ce,_e,ue,pe,de,Pe,me,Se,ce,se,xe,Fe,Be,Me,ye,le,Oe,Ee,Ae],styles:[".add-book-container[_ngcontent-%COMP%]{max-width:1200px;margin:2rem auto;padding:2rem;background-color:#fff;border-radius:8px;box-shadow:0 2px 4px #0000001a}h2[_ngcontent-%COMP%]{color:#fee715;margin-bottom:2rem;font-size:1.8rem;font-weight:500}.book-form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1.5rem}.form-row[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:1rem}.full-width[_ngcontent-%COMP%]{width:100%}.selected-items[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem;margin:1rem 0}.chips-container[_ngcontent-%COMP%]{background-color:#f8f9fa;padding:1rem;border-radius:8px}.chips-container[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{color:#333;margin-bottom:.5rem;font-size:1rem;font-weight:500}.button-row[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:1rem;margin-top:2rem}button[type=submit][_ngcontent-%COMP%]{background-color:#fee715;color:#000;padding:.5rem 2rem}button[type=submit][_ngcontent-%COMP%]:disabled{background-color:#ccc;color:#666}  .mat-mdc-form-field{width:100%}  .mat-mdc-form-field-subscript-wrapper{display:none}  .mat-mdc-form-field-infix{padding:.5rem 0}  .mat-mdc-text-field-wrapper{background-color:#fff!important}  .mat-mdc-form-field-flex{background-color:#fff!important}  .mat-mdc-input-element{color:#333!important}  .mat-mdc-form-field-label{color:#666!important}  .mat-mdc-select-value{color:#333!important}  .mat-mdc-select-arrow{color:#666!important}  .mat-mdc-button,   .mat-mdc-raised-button{transition:none!important}  .mat-mdc-button:hover,   .mat-mdc-raised-button:hover{background-color:inherit!important}  .mat-mdc-chip{background-color:#fee715!important;color:#000!important}  .mat-mdc-chip-remove{color:#000!important}.spinner[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_spin 1s linear infinite}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}@media (max-width: 768px){.add-book-container[_ngcontent-%COMP%]{margin:1rem;padding:1rem}.form-row[_ngcontent-%COMP%]{grid-template-columns:1fr}.button-row[_ngcontent-%COMP%]{flex-direction:column}.button-row[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:100%}.selected-items[_ngcontent-%COMP%]{flex-direction:column}}"]})};export{qe as AddBookComponent};
