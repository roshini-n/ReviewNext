import{a as ge}from"./chunk-GPWNICVS.js";import{a as Ge,b as xe,d as Ie,g as ye,h as Ee,i as we,j as Ae,k as Fe,l as Oe,n as Pe,o as ke,p as Te}from"./chunk-ON2IKYVN.js";import{$ as ee,Bb as fe,Cb as he,Db as _e,Eb as be,Hb as ve,Ib as Ce,Kb as Se,Lb as Me,Nb as De,R as J,Ra as me,T as g,V as Q,W as Z,ab as le,b as X,ba as te,da as ie,fa as re,ga as ne,gb as se,h as Y,ha as ae,hb as pe,ia as oe,ib as de,jb as ce,kb as ue}from"./chunk-VRLREQ5H.js";import{$b as v,$c as j,Ab as u,H as N,Ib as p,J as A,L as q,P as U,Sb as a,Tb as n,Ub as h,Yb as I,Z as F,_ as B,a as D,ad as z,b as R,bc as O,dd as H,ea as $,h as w,hb as s,id as K,ja as L,ka as C,kc as y,lc as l,nc as G,t as x,ta as _,u as V,ua as b,ub as W,xc as P,y as M,yc as k}from"./chunk-5JKIZQAZ.js";var E=class o{constructor(e){this.http=e}apiKey="873b450f6ff648fdbdaf5de426e99436";baseUrl="https://api.rawg.io/api/games";cleanTitle(e){return e.toLowerCase().replace(/[^a-z0-9]/g,"")}calculateSimilarity(e,t){let i=this.cleanTitle(e),r=this.cleanTitle(t),m=i.length>r.length?i:r,d=i.length>r.length?r:i;return m.length===0?1:(m.length-this.editDistance(m,d))/m.length}editDistance(e,t){e=e.toLowerCase(),t=t.toLowerCase();let i=[];for(let r=0;r<=e.length;r++){let m=r;for(let d=0;d<=t.length;d++)if(r===0)i[d]=d;else if(d>0){let f=i[d-1];e.charAt(r-1)!==t.charAt(d-1)&&(f=Math.min(Math.min(f,m),i[d])+1),i[d-1]=m,m=f}r>0&&(i[t.length]=m)}return i[t.length]}searchGame(e,t){console.log("Searching for game:",e,t?`(Year: ${t})`:"");let i=this.cleanTitle(e),r=`${this.baseUrl}?key=${this.apiKey}&search=${encodeURIComponent(e)}&ordering=-rating&page_size=10`;return t&&(r+=`&dates=${t}-01-01,${t}-12-31`),this.http.get(r).pipe(B(m=>{if(!m.results||m.results.length===0)return x({imageUrl:"",developer:"",publisher:""});let f=m.results.find(c=>this.cleanTitle(c.name)===i||this.cleanTitle(c.name).includes(i)||i.includes(this.cleanTitle(c.name)))||m.results[0];return f?this.http.get(`${this.baseUrl}/${f.id}?key=${this.apiKey}`).pipe(M(c=>({imageUrl:c.background_image||"",developer:c.developers?.map(S=>S.name).join(", ")||"",publisher:c.publishers?.map(S=>S.name).join(", ")||""})),A(c=>x({imageUrl:f.background_image||"",developer:"",publisher:""}))):x({imageUrl:"",developer:"",publisher:""})}),A(m=>(console.error("Error searching game:",m),m.status===401&&console.error("API key might be invalid or not yet approved"),V(()=>new Error("Failed to search for game information")))))}static \u0275fac=function(t){return new(t||o)(L(X))};static \u0275prov=$({token:o,factory:o.\u0275fac,providedIn:"root"})};function qe(o,e){o&1&&(a(0,"mat-error"),l(1,"Title is required"),n())}function Ue(o,e){o&1&&(a(0,"mat-error"),l(1,"Description is required"),n())}function Be(o,e){if(o&1&&(a(0,"mat-option",25),l(1),n()),o&2){let t=e.$implicit;p("value",t),s(),G(" ",t," ")}}function $e(o,e){if(o&1){let t=I();a(0,"mat-chip",26),v("removed",function(){let r=_(t).$implicit,m=O();return b(m.removePlatform(r))}),l(1),a(2,"button",27)(3,"mat-icon"),l(4,"cancel"),n()()()}if(o&2){let t=e.$implicit;s(),G(" ",t," ")}}function Le(o,e){if(o&1&&(a(0,"mat-option",25),l(1),n()),o&2){let t=e.$implicit;p("value",t),s(),G(" ",t," ")}}function We(o,e){if(o&1){let t=I();a(0,"mat-chip",26),v("removed",function(){let r=_(t).$implicit,m=O();return b(m.removeGenre(r))}),l(1),a(2,"button",27)(3,"mat-icon"),l(4,"cancel"),n()()()}if(o&2){let t=e.$implicit;s(),G(" ",t," ")}}function je(o,e){o&1&&(a(0,"mat-error"),l(1,"Release date is required"),n())}function ze(o,e){o&1&&(a(0,"mat-error"),l(1,"Developer is required"),n())}function He(o,e){o&1&&(a(0,"mat-error"),l(1,"Publisher is required"),n())}function Ke(o,e){o&1&&(a(0,"mat-hint"),l(1,"Will be automatically filled based on game title"),n())}function Xe(o,e){o&1&&(a(0,"mat-hint"),l(1,"Searching for game image..."),n())}function Ye(o,e){o&1&&(a(0,"mat-icon",28),l(1,"search"),n())}var Re=class o{fb=C(ne);gameService=C(ge);igdbService=C(E);snackBar=C(Oe);router=C(Y);gameForm;separatorKeysCodes=[13,188];platforms=[];selectedGenres=[];isSubmitting=!1;isSearchingImage=!1;options=["PC","PlayStation 5","PlayStation 4","Xbox Series X|S","Xbox One","Nintendo Switch","Nintendo 3DS","Nintendo Wii U","Mobile","VR","Other"];genres=["Action","Adventure","RPG","Strategy","Sports","Racing","Puzzle","Platformer","Fighting","Shooter","Simulation","Horror","MMO","MOBA","Battle Royale","Card Game","Board Game","Educational","Music","Party","Sandbox"];filteredOptions;filteredGenres;constructor(){this.gameForm=this.fb.group({title:["",[g.required,g.minLength(1)]],description:["",[g.required,g.minLength(10)]],platformInput:[""],genreInput:[""],releaseDate:["",g.required],developer:["",[g.required,g.minLength(1)]],publisher:["",[g.required,g.minLength(1)]],imageUrl:["",[g.pattern("https?://.*")]]})}ngOnInit(){this.filteredOptions=this.gameForm.get("platformInput")?.valueChanges.pipe(F(""),M(e=>this._filter(e||"",this.options)))||new w,this.filteredGenres=this.gameForm.get("genreInput")?.valueChanges.pipe(F(""),M(e=>this._filter(e||"",this.genres)))||new w,this.gameForm.get("title")?.valueChanges.pipe(q(500),U(),N(e=>e&&e.length>2)).subscribe(e=>{this.isSearchingImage=!0;let t=this.gameForm.get("releaseDate")?.value,i=t?new Date(t).getFullYear():void 0;this.igdbService.searchGame(e,i).subscribe({next:r=>{console.log("Received search result:",r),r.imageUrl&&(console.log("Setting form values:",{imageUrl:r.imageUrl,developer:r.developer,publisher:r.publisher}),this.gameForm.patchValue({imageUrl:r.imageUrl,developer:r.developer,publisher:r.publisher},{emitEvent:!1}),console.log("Form values after update:",this.gameForm.value)),this.isSearchingImage=!1},error:r=>{console.error("Error fetching game information:",r),this.isSearchingImage=!1}})})}_filter(e,t){let i=e.toLowerCase();return t.filter(r=>r.toLowerCase().includes(i))}addPlatform(){let e=this.gameForm.get("platformInput")?.value;e&&!this.platforms.includes(e)&&this.platforms.push(e),this.gameForm.get("platformInput")?.setValue("")}removePlatform(e){this.platforms=this.platforms.filter(t=>t!==e)}addGenre(){let e=this.gameForm.get("genreInput")?.value;e&&!this.selectedGenres.includes(e)&&this.selectedGenres.push(e),this.gameForm.get("genreInput")?.setValue("")}removeGenre(e){this.selectedGenres=this.selectedGenres.filter(t=>t!==e)}onSubmit(){if(this.gameForm.valid&&this.platforms.length>0&&this.selectedGenres.length>0){this.isSubmitting=!0;let e=R(D({},this.gameForm.value),{platforms:this.platforms,genres:this.selectedGenres,rating:0,totalRatingScore:0,numRatings:0,views:0,releaseDate:this.gameForm.get("releaseDate")?.value.toISOString(),dateAdded:new Date().toISOString()});this.gameService.addGame(e).subscribe({next:()=>{this.snackBar.open("Game added successfully!","Close",{duration:3e3}),this.router.navigate(["/games"])},error:t=>{console.error("Error adding game:",t),this.snackBar.open("Error adding game. Please try again.","Close",{duration:3e3}),this.isSubmitting=!1}})}else{let e="Please fill in all required fields";this.platforms.length===0&&(e+=" and add at least one platform"),this.selectedGenres.length===0&&(e+=" and add at least one genre"),this.snackBar.open(e,"Close",{duration:3e3})}}onCancel(){this.router.navigate(["/games"])}static \u0275fac=function(t){return new(t||o)};static \u0275cmp=W({type:o,selectors:[["app-add-game"]],decls:77,vars:22,consts:[["auto","matAutocomplete"],["autoGenres","matAutocomplete"],["picker",""],[1,"add-game-container"],[3,"ngSubmit","formGroup"],[1,"form-row"],["appearance","outline"],["matInput","","formControlName","title","required",""],[4,"ngIf"],["matInput","","formControlName","description","required","","rows","3"],["matInput","","formControlName","platformInput",3,"matAutocomplete"],[3,"value",4,"ngFor","ngForOf"],["matSuffix","","mat-icon-button","","type","button",3,"click"],[1,"selected-items"],[3,"removed",4,"ngFor","ngForOf"],["matInput","","formControlName","genreInput",3,"matAutocomplete"],["matInput","","formControlName","releaseDate","required","",3,"matDatepicker"],["matSuffix","",3,"for"],["matInput","","formControlName","developer","required",""],["matInput","","formControlName","publisher","required",""],["matInput","","formControlName","imageUrl"],["matSuffix","","class","spinner",4,"ngIf"],[1,"form-actions"],["mat-raised-button","","color","primary","type","submit",3,"disabled"],["mat-button","","type","button",3,"click"],[3,"value"],[3,"removed"],["matChipRemove",""],["matSuffix","",1,"spinner"]],template:function(t,i){if(t&1){let r=I();a(0,"div",3)(1,"h1"),l(2,"Add New Game"),n(),a(3,"form",4),v("ngSubmit",function(){return _(r),b(i.onSubmit())}),a(4,"div",5)(5,"mat-form-field",6)(6,"mat-label"),l(7,"Title"),n(),h(8,"input",7),u(9,qe,2,0,"mat-error",8),n(),a(10,"mat-form-field",6)(11,"mat-label"),l(12,"Description"),n(),h(13,"textarea",9),u(14,Ue,2,0,"mat-error",8),n()(),a(15,"div",5)(16,"mat-form-field",6)(17,"mat-label"),l(18,"Platforms"),n(),h(19,"input",10),a(20,"mat-autocomplete",null,0),u(22,Be,2,2,"mat-option",11),P(23,"async"),n(),a(24,"button",12),v("click",function(){return _(r),b(i.addPlatform())}),a(25,"mat-icon"),l(26,"add"),n()()(),a(27,"div",13)(28,"mat-chip-listbox"),u(29,$e,5,1,"mat-chip",14),n()()(),a(30,"div",5)(31,"mat-form-field",6)(32,"mat-label"),l(33,"Genres"),n(),h(34,"input",15),a(35,"mat-autocomplete",null,1),u(37,Le,2,2,"mat-option",11),P(38,"async"),n(),a(39,"button",12),v("click",function(){return _(r),b(i.addGenre())}),a(40,"mat-icon"),l(41,"add"),n()()(),a(42,"div",13)(43,"mat-chip-listbox"),u(44,We,5,1,"mat-chip",14),n()()(),a(45,"div",5)(46,"mat-form-field",6)(47,"mat-label"),l(48,"Release Date"),n(),h(49,"input",16)(50,"mat-datepicker-toggle",17)(51,"mat-datepicker",null,2),u(53,je,2,0,"mat-error",8),n(),a(54,"mat-form-field",6)(55,"mat-label"),l(56,"Developer"),n(),h(57,"input",18),u(58,ze,2,0,"mat-error",8),n()(),a(59,"div",5)(60,"mat-form-field",6)(61,"mat-label"),l(62,"Publisher"),n(),h(63,"input",19),u(64,He,2,0,"mat-error",8),n(),a(65,"mat-form-field",6)(66,"mat-label"),l(67,"Image URL"),n(),h(68,"input",20),u(69,Ke,2,0,"mat-hint",8)(70,Xe,2,0,"mat-hint",8)(71,Ye,2,0,"mat-icon",21),n()(),a(72,"div",22)(73,"button",23),l(74," Add Game "),n(),a(75,"button",24),v("click",function(){return _(r),b(i.onCancel())}),l(76,"Cancel"),n()()()()}if(t&2){let r,m,d,f,c,S=y(21),Ve=y(36),T=y(52);s(3),p("formGroup",i.gameForm),s(6),p("ngIf",(r=i.gameForm.get("title"))==null?null:r.hasError("required")),s(5),p("ngIf",(m=i.gameForm.get("description"))==null?null:m.hasError("required")),s(5),p("matAutocomplete",S),s(3),p("ngForOf",k(23,18,i.filteredOptions)),s(7),p("ngForOf",i.platforms),s(5),p("matAutocomplete",Ve),s(3),p("ngForOf",k(38,20,i.filteredGenres)),s(7),p("ngForOf",i.selectedGenres),s(5),p("matDatepicker",T),s(),p("for",T),s(3),p("ngIf",(d=i.gameForm.get("releaseDate"))==null?null:d.hasError("required")),s(5),p("ngIf",(f=i.gameForm.get("developer"))==null?null:f.hasError("required")),s(6),p("ngIf",(c=i.gameForm.get("publisher"))==null?null:c.hasError("required")),s(5),p("ngIf",!i.isSearchingImage),s(),p("ngIf",i.isSearchingImage),s(),p("ngIf",i.isSearchingImage),s(2),p("disabled",!i.gameForm.valid)}},dependencies:[K,j,z,H,oe,ee,J,Q,Z,re,te,ie,ae,Ce,ve,fe,_e,he,be,Me,Se,ue,de,ce,De,le,ye,xe,Ie,Ge,pe,se,Fe,Ee,we,Ae,me,Te,Pe,ke],styles:[".example-form[_ngcontent-%COMP%]{min-width:150px;max-width:500px;width:100%;margin-left:2%;margin-top:2%;margin-bottom:0%}.example-full-width[_ngcontent-%COMP%]{width:100%}.submit-button[_ngcontent-%COMP%]{margin-left:2%}.mat-grey-back[_ngcontent-%COMP%]{background-color:#404147}.add-game-container[_ngcontent-%COMP%]{max-width:1200px;margin:2rem auto;padding:2rem;background:#fff;border-radius:8px;box-shadow:0 2px 4px #0000001a}h1[_ngcontent-%COMP%]{color:#fee715;margin-bottom:2rem;font-size:2rem}.form-row[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;gap:1.5rem;margin-bottom:1.5rem}mat-form-field[_ngcontent-%COMP%]{width:100%}.selected-items[_ngcontent-%COMP%]{margin-top:.5rem}mat-chip-listbox[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:.5rem}mat-chip[_ngcontent-%COMP%]{background-color:#fee715;color:#000}.form-actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:1rem;margin-top:2rem}button[type=submit][_ngcontent-%COMP%]{background-color:#fee715;color:#000}button[type=submit][_ngcontent-%COMP%]:hover{background-color:#e6d100}@media (max-width: 768px){.form-row[_ngcontent-%COMP%]{grid-template-columns:1fr}.add-game-container[_ngcontent-%COMP%]{padding:1rem;margin:1rem}}.spinner[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_spin 1s linear infinite}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}"]})};export{Re as AddGameComponent};
