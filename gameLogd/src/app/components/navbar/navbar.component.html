<mat-toolbar color="primary" id="leftside" [class.home-navbar]="isHomePage">
  <h1 [routerLink]="authService.currentUserSig() ? '/dashboard' : '/'" class="site-title" style="cursor: pointer;">
    Review<span class="highlight">Next</span>
  </h1>

  @if (!isLoginOrRegister) {
    <div class="search-container">
      <form class="search-form" (submit)="$event.preventDefault(); onSearch();">
        <input class="search-input" type="search" placeholder="Search for products, reviews, and more..." [(ngModel)]="searchQuery" name="search" />
        <button class="search-button" type="submit">Search</button>
      </form>
    </div>
  }

  <div class="right-buttons hidden-mobile">
    @if (authService.currentUserSig()) {
      <button mat-button [matMenuTriggerFor]="categoryMenu" class="categories-button" color="grey-back">
        <span class="navbar_button">Categories</span>
        <mat-icon>arrow_drop_down</mat-icon>
      </button>
      @if (isAdmin) {
        <button mat-button (click)="navigateToAdmin()" class="admin-button" color="warn">
          <mat-icon>admin_panel_settings</mat-icon>
          <span class="navbar_button">Admin</span>
        </button>
      }
      <a routerLink="profile" class="profile-button">
        <img [src]="avatarUrl" alt="Profile" class="profile-image">
      </a>
    } @else if (!isLoginOrRegister) {
      <button mat-button color="grey-back" routerLink="login">
        <span class="navbar_button">Login</span>
      </button>
    }
  </div>
</mat-toolbar>

<!-- Mobile Menu Trigger -->
<button class="mobile-menu-trigger visible-mobile" (click)="toggleMobileMenu()" aria-label="Menu">
  <mat-icon>{{ isMobileMenuOpen ? 'close' : 'menu' }}</mat-icon>
</button>

<!-- Mobile Search (only when menu open) -->
@if (!isLoginOrRegister && isMobileMenuOpen) {
  <div class="mobile-search-container visible-mobile">
    <form class="mobile-search-form" (submit)="$event.preventDefault(); onSearch(); closeMobileMenu();">
      <input class="mobile-search-input" type="search" placeholder="Search..." [(ngModel)]="searchQuery" name="search" />
      <button class="mobile-search-button" type="submit"><mat-icon>search</mat-icon></button>
    </form>
  </div>
}

@if (isMobileMenuOpen) { <div class="mobile-menu-overlay" (click)="closeMobileMenu()"></div> }

<div class="mobile-menu" [class.active]="isMobileMenuOpen">
  <div class="mobile-menu-header">
    <h3>Menu</h3>
    <button class="mobile-menu-close" (click)="closeMobileMenu()" aria-label="Close menu"><mat-icon>close</mat-icon></button>
  </div>

  <div class="mobile-menu-content">
    @if (authService.currentUserSig()) {
      <div class="mobile-menu-profile">
        <img [src]="avatarUrl" alt="Profile" class="mobile-profile-image">
        <span class="mobile-profile-name">Profile</span>
      </div>
      <div class="mobile-menu-divider"></div>
    }

    @if (authService.currentUserSig()) {
      <div class="mobile-menu-section">
        <h4 class="mobile-menu-section-title">Categories</h4>
        <a class="mobile-menu-item" routerLink="games" (click)="onMobileMenuItemClick()"><mat-icon>sports_esports</mat-icon><span>Games</span></a>
        <a class="mobile-menu-item" routerLink="books" (click)="onMobileMenuItemClick()"><mat-icon>menu_book</mat-icon><span>Books</span></a>
        <a class="mobile-menu-item" routerLink="movies" (click)="onMobileMenuItemClick()"><mat-icon>movie</mat-icon><span>Movies</span></a>
        <a class="mobile-menu-item" routerLink="electronic-gadgets" (click)="onMobileMenuItemClick()"><mat-icon>devices</mat-icon><span>Electronic Gadgets</span></a>
        <a class="mobile-menu-item" routerLink="web-series" (click)="onMobileMenuItemClick()"><mat-icon>live_tv</mat-icon><span>Web Series</span></a>
        <a class="mobile-menu-item" routerLink="beauty-products" (click)="onMobileMenuItemClick()"><mat-icon>spa</mat-icon><span>Beauty Products</span></a>
      </div>
      <div class="mobile-menu-divider"></div>
    }

    @if (authService.currentUserSig()) {
      <div class="mobile-menu-section">
        <h4 class="mobile-menu-section-title">Account</h4>
        <a class="mobile-menu-item" routerLink="profile" (click)="onMobileMenuItemClick()"><mat-icon>person</mat-icon><span>Profile</span></a>
        @if (isAdmin) {
          <a class="mobile-menu-item admin-item" (click)="navigateToAdmin()"><mat-icon>admin_panel_settings</mat-icon><span>Admin Dashboard</span></a>
        }
        <button class="mobile-menu-item mobile-menu-button" (click)="logout()"><mat-icon>logout</mat-icon><span>Logout</span></button>
      </div>
    } @else if (!isLoginOrRegister) {
      <div class="mobile-menu-section">
        <a class="mobile-menu-item" routerLink="login" (click)="onMobileMenuItemClick()"><mat-icon>login</mat-icon><span>Login</span></a>
        <a class="mobile-menu-item" routerLink="register" (click)="onMobileMenuItemClick()"><mat-icon>person_add</mat-icon><span>Register</span></a>
      </div>
    }

    <div class="mobile-menu-divider"></div>
    <div class="mobile-menu-section">
      <h4 class="mobile-menu-section-title">Theme</h4>
      <button class="mobile-menu-item mobile-menu-button" (click)="switchToLightTheme(); closeMobileMenu()"><mat-icon>light_mode</mat-icon><span>Light Mode</span></button>
      <button class="mobile-menu-item mobile-menu-button" (click)="switchToDarkTheme(); closeMobileMenu()"><mat-icon>dark_mode</mat-icon><span>Dark Mode</span></button>
      <button class="mobile-menu-item mobile-menu-button" (click)="switchToCustomTheme(); closeMobileMenu()"><mat-icon>palette</mat-icon><span>Custom Theme</span></button>
    </div>
  </div>
</div>

<mat-menu #categoryMenu="matMenu">
  <button mat-menu-item routerLink="games"><mat-icon>sports_esports</mat-icon><span>Games</span></button>
  <button mat-menu-item routerLink="books"><mat-icon>menu_book</mat-icon><span>Books</span></button>
  <button mat-menu-item routerLink="movies"><mat-icon>movie</mat-icon><span>Movies</span></button>
  <button mat-menu-item routerLink="electronic-gadgets"><mat-icon>devices</mat-icon><span>Electronic Gadgets</span></button>
  <button mat-menu-item routerLink="web-series"><mat-icon>live_tv</mat-icon><span>Web Series</span></button>
  <button mat-menu-item routerLink="beauty-products"><mat-icon>spa</mat-icon><span>Beauty Products</span></button>
</mat-menu>

<mat-menu #userMenu="matMenu">
  <button mat-menu-item routerLink="profile"><mat-icon>person</mat-icon><span>My Profile</span></button>
  <button mat-menu-item routerLink="my-lists"><mat-icon>list</mat-icon><span>My Lists</span></button>
  <button mat-menu-item routerLink="mylog"><mat-icon>book</mat-icon><span>My Logs</span></button>
  <mat-divider></mat-divider>
  <button mat-menu-item (click)="authService.logout()"><mat-icon>logout</mat-icon><span>Logout</span></button>
</mat-menu>

<mat-menu #themeMenu="matMenu">
  <button mat-menu-item (click)="switchToLightTheme()"><mat-icon>light_mode</mat-icon><span>Light</span></button>
  <button mat-menu-item (click)="switchToDarkTheme()"><mat-icon>dark_mode</mat-icon><span>Dark</span></button>
  <button mat-menu-item (click)="switchToCustomTheme()"><mat-icon>palette</mat-icon><span>Custom</span></button>
</mat-menu>
